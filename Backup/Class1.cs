using System;
using System.Data;

namespace ZConsultaBuro
{

	class Class1
	{
		//ConnectTCPClient conn = new ConnectTCPClient("JESUS-MONTERO",22);
		static void Main(string[] args)
		{
			#region TOMAR LOS ARGUMENTOS ENVIADOS DESDE ABAP

			string idConsulta=string.Empty;
			string partner=string.Empty;
			string user=string.Empty;
			string pass=string.Empty;
			string server=string.Empty;
			short sapID=0;
			short client=038;
			string portBC=string.Empty;
			string userBC=string.Empty;
			string serverBC=string.Empty;
			bool flag= false;//ESTA FLAG ES PARA OBJETO DE PRUEBAS DESDE C#
				for (int i = 0; i < args.Length; i++)
				{
					flag=true;//ESTA FLAG ES PARA OBJETO DE PRUEBAS DESDE C#

					if(i%2 == 0)
					{
						switch(args[i])
						{
							case "ID_CONSULTA": 
								idConsulta = args[i+1];
								//Console.WriteLine("ID CONSULTA: "+idConsulta);//Borrar
								break;
							case "PARTNER": 
								partner = args[i+1];
								//Console.WriteLine("ID PARTNER: "+partner);//Borrar
								break;
							case "SAP_USERNAME": 
								user = args[i+1];
								//Console.WriteLine("ID SAP_USERNAME: "+user);//Borrar
								break;
							case "SAP_PASS": 
								pass = args[i+1];
								//Console.WriteLine("ID SAP_PASS: "+pass);//Borrar
								break;
							case "SAP_SERVER": 
								server = args[i+1];
								//Console.WriteLine("ID SAP_SERVER: "+server);//Borrar
								break;
							case "SAP_ID": 
								sapID = short.Parse(args[i+1]);
								//Console.WriteLine("ID SAP_ID: "+sapID);//Borrar
								break;
							case "SAP_CLIENT": 
								client = short.Parse(args[i+1]);
								//Console.WriteLine("ID SAP_CLIENT: "+client);//Borrar
								break;
							case "BURO_SERVER": 
								serverBC = args[i+1];
								//Console.WriteLine("ID BURO_SERVER: "+serverBC);//Borrar
								break;
							case "BURO_PORT": 
								portBC = args[i+1];
								//Console.WriteLine("ID BURO_PORT: "+portBC);//Borrar
								break;
							case "BURO_USER": 
								userBC = args[i+1];
								//Console.WriteLine("ID BURO_USER: "+userBC);//Borrar
								break;
						}
					}
				}
			#endregion
			#region REGION de OBJETO PRUEBAS DESDE C#
			if(flag== false)
			{
				Console.WriteLine("LA CoNNEXION SE HARA CON LOS VALORES DE SIEMPRE" );

				idConsulta = "0000000000058";
				//partner = "0000000001";
				partner   = "0001000050";
				user = "CTDEV";
				pass ="038dycsi";
				server = "200.57.135.2";
				sapID = 0;
				client =38;
			}
			#endregion
			//ConnexionSAP conn = new ConnexionSAP("CTDEV","038dycsi","200.57.135.2",038,0);
			ConnexionSAP conn = new ConnexionSAP(user,pass,server,client,sapID);
			FormatoINTL consul = new FormatoINTL(conn);
			consul.ConsultaFinalAlRFC(idConsulta,partner);
			#region asdasdasd
			/*SapConnectorBC proxy = conn.establecerConeccionSap();
			//instancia.establecerConeccionSap("CTDEV","038dycsi","200.57.135.2",038,0);
			Z00_BURO_INTLTable resultadoIntl = new Z00_BURO_INTLTable();
			Z00_BURO_PNTable resultadoPN = new Z00_BURO_PNTable();
			Z00_BURO_PATable resultadoPA = new Z00_BURO_PATable();
			

			//Z00_BURO_PA asd = new Z00_BURO_PA();//
			//resultadoPA.Add(asd);//
			try
			{
				proxy.Connection.Open();
				//proxy.Zrfc_Buro_Bp("0000000191",ref resultadoAdicional,ref resultadoBase);
				//proxy.Zrfc_Buro_Bp(partner,ref resultadoIntl,ref resultadoPN,ref resultadoPA);"0001000050"
				proxy.Zrfc_Buro_Bp(idConsulta,partner,ref resultadoIntl,ref resultadoPA,ref resultadoPN);
				proxy.Connection.Close();
			}
			catch(SAP.Connector.RfcLogonException a)
			{
				Console.WriteLine("Existe un error el Usuario o contraseña, el sistema no se ha podido conectar "+a);
			}
			catch(SAP.Connector.RfcCommunicationException a)
			{
				Console.WriteLine("El usuario se tardo demacionado en aceptar que la conexion era segura"+a);
			
			}
			catch(SAP.Connector.RfcException a)
			{
				Console.WriteLine("No se encontro el RFC"+a);
			
			}
			//Begin JRojas : Convierte del resulta de ABAP a ojetos locales de .NET para facilitar su manejo
			DataTable dt = resultadoIntl.ToADODataTable();
			DataTable dt2 = resultadoPN.ToADODataTable();
			DataTable dt3 = resultadoPA.ToADODataTable();

			FormatoINTL objConsulta = new FormatoINTL();

			objConsulta.setDataTableEncabezadoIntl(dt);//Envie a la clase FormateINTL su correspondiente datatable
			objConsulta.setDataTableSegmentoPN(dt2);//Envie a la clase FormateINTL su correspondiente datatable
			objConsulta.setDataTableSegmentoPA(dt3);//Envie a la clase FormateINTL su correspondiente datatable
			//END JRojas

			//BEGIN JRojas : Para la creacion la consulta se tienen que mandar llamar en este orden
			string Consulta;
			Consulta = objConsulta.EncabezadoINTL();
			Consulta += objConsulta.SegmentoDeNombre();
			Consulta += objConsulta.SegmentoDeDireccion();
			Consulta = objConsulta.SegmentoDeCierre(Consulta);
			Console.WriteLine(Consulta);
			//END JRojas
			//string asdasd= "PN07TARJETA0007ABIERTA0204CASO0306CUATRO0408150519500510TAAC5005150802MX090121101F1201MPA13SERVIDOR200000106CENTRO0210CUAUHTEMOC0312CD DE MEXICO0402DF0505060001001H120830092004PA13SERVIDOR200000106CENTRO0210CUAUHTEMOC0312CD DE MEXICO0402DF0505060001001H120830092004PA13SERVIDOR200000106CENTRO0210CUAUHTEMOC0312CD DE MEXICO0402DF0505060001001H120830092004PA13SERVIDOR200000106CENTRO0210CUAUHTEMOC0312CD DE MEXICO0402DF0505060001001H120830092004TL08300920040205BANCO0501I0601R0702CC0802N$1101Z12038201308150120041408308200401508150620041708300920041801M21051485022057597+230512000240102602012708111111002808010820042908010120043103008";
			//string asdasd2= "3802-1TL08300920040205BANCO0501I0601R0702CC0802N$1101Z120101308300319801408300420001608010120011708300920041801M2104300022020+230435002401026020127241111111111111111111111112808010820042908011219973002CZ3103084420801012001000";
*/
			#endregion
			#region ejemploRespuesta
			string asdasd3="PN07ARRECIN0004SULE0206ANDREA1201FPA21CENTRAL DEL NORTE ";
			asdasd3+="3080114LOMAS VIRREYES0214MIGUEL";
			asdasd3+=" HIDALGO0306MEXICO0402DF050511000120827062002TL0827062002000400010213CIA Q'";
			asdasd3+=" OTORGA0501I0601R0702CC0802N$100111101M120121308010419691408250519911508250519";
			asdasd3 += "911608171219901708270620021801M2104600022022+26020127241111111111111111111111";//El tipo de dato es la M estaba "1801M" temp se cambia por "18014"
			asdasd3+="112808010520022908010620003002CC31030243802-";
			asdasd3+="1TL0827062002000400010205BANCO0501I0601R0702CC0802N$1002121101M12010130818101";
			asdasd3 += "9991408181020001508181020001608181020001708270620021801M21052000022020+250122";//El tipo de dato es la M estaba "1801M" temp se cambia por "18014"
			asdasd3+="6020127241111111111111111112111212808010520022908010620003002CZ31030243202023";
			asdasd3+="6010370801112000380202TL08270620020205BANCO0501I0601R0702CC0802N$1002111101M1";
			asdasd3 += "20101308010519871408120619981508120619981608010719981708270620021801M21054300";//El tipo de dato es la M estaba "1801M" temp se cambia por "18014"
			asdasd3 += "02202002305570002602012724111111111111111111111111280801052002290801062000300";//esta venia asi ahi k checar "22020+" se cambio por 0
			asdasd3+="2CZ31030243802-1IQ08010720020216CONSUMIDOR ";
			asdasd3+="FINAL0402MI0502N$06031000701IIQ08010720020110BC999910010215TWONATIONS ";
			asdasd3+="BANK0402EQ060100701IIQ08280620020216CONSUMIDOR  ";
			asdasd3+="FINAL 0402CC0502N$060420000701IRS082706200200020001020002020003020004020005020";
			asdasd3+="00602030702000802000904000310040000110400031204000313040000140400031502001602";
			asdasd3+="021701Y1805NNNNN1901Y2002N$21010220102302202401025010260102701028020+29010300";//aki habia un mas
			asdasd3+="10310200320200330200340801041969350818101999360202370801072002380200390800000";
			asdasd3+="000400200410800000000CR0406700000EL TOTAL DE CUENTAS CONTENIDAS EN ESTE";
			asdasd3+="EXPEDIENTE ESTAN SIENDO UTILIZADAS PARA UN PROCESO DE PRUEBA ASI COMO PODRA";
			asdasd3+="SER UTILIZADO POR CUALQUIER INSTITUCIÓN QUE LO REQUIERA PARA ESTE USO. LOS";
			asdasd3+="DATOS PERSONALES DE ESTE SUJETO INVESTIGADO SON FICTICIOS COMO SON PRIMER";
			asdasd3+="NOMBRE, SEGUNDO NOMBRE, APELLIDO PATERNO, APELLIDO MATERNO, CALLE Y NUMERO,";
			asdasd3+="COLONIA, DELEGACIÓN, CIUDAD, ESTADO Y CODIGO POSTAL, DOMICILIO DE EMPLEO,";
			asdasd3+="COMPAÑIA, PUESTO, SALARIO, CALLE Y NÚMERO, COLONIA, DELEGACIÓN, CIUDAD,";
			asdasd3+="ESTADO, CÓDIGO POSTAL, TELÉFONO. EL TOTAL DE CUENTAS QUE SE DESPLIEGAN EN EL";
			asdasd3+="EXPEDIENTE DE INSTITUCIONES FICTICIAS ASI COMO LOS DATOS CONTABLES QUE";
			asdasd3+="CONTIENE EL DETALLE DE LOS CRÉDITOSES050206000090449791580102**";

			asdasd3 = asdasd3.Replace("+","0");

			string respuestaPruebaHawk ="INTL10BROWSER OPT              ";
respuestaPruebaHawk+="MX0000BC1234567810PN07SEGUNDO0007SEGUNDO0207SEGUNDO0408181019300510SESS3010180802MX1414";
respuestaPruebaHawk+="IFEPRUEBAS1005PA12CALLE 802 SN0110EL ";
respuestaPruebaHawk+="DURAZNO0205COSIO0403AGS05052046707102224828999120802092009PA21SAL Y PIMIENTA  8 LT";//20
respuestaPruebaHawk+="50110EL DURAZNO0205COSIO0403AGS050520472120830102002PE22EMPRESA DE TRABAJO";//18
respuestaPruebaHawk+="151000007105557129999170802092009TL08301220020110BC123456780206BC-1TN0411DICIEMBRE";
respuestaPruebaHawk+="20501I0601R0702CC0802N$1101Z12032501308300420011408301220011508301220011708301020021801A";
respuestaPruebaHawk+="210458002204950+23047500260201IQ08030920090110BC996010010206BC-";
respuestaPruebaHawk+="1TN0402AF060100701IIQ08020920090110BC123456780206BC-";
respuestaPruebaHawk+="1TN0402AF060100701IRS083012200200020001020002020003020004020005020006020107020008020009";
respuestaPruebaHawk+="04000110040000110400011204000013040000140400001502001602011701Y1805NNNNN1901N2002N$21045";
respuestaPruebaHawk+="800220475002304950+2401025032502602122701028020+2901030010310200320200330200340830042001";
respuestaPruebaHawk+="350830042001360201370802092009380200390800000000400200410800000000HI0803092009000300101";
respuestaPruebaHawk+="16BURO DE CREDITO 0248VER MENSAJES DE COINCIDENCIA POR REP. DE";//40
respuestaPruebaHawk+=" CREDITOHR081408200900030310116PRUEBA1 BC      0248EMPLEO - 5557129999 COINCIDENCIA POR ";//36
respuestaPruebaHawk+="NUM TEL    HR081408200900030310116PRUEBA2 BC      0248DATOS GENERALES - COINCIDENCIA ";//31
respuestaPruebaHawk+="POR NOMBRE       HR081408200900030310116PRUEBA3 BC      0248DATOS GENERALES -";//17
respuestaPruebaHawk+="COINCIDENCIA POR RFC           HR081408200900030310116PRUEBA4 BC      0248DOM. PART. -";//12
respuestaPruebaHawk+="2224828999 COINCIDENCIA POR  NUM TELHR081408200900030310116PRUEBA5 BC      0248DATOS ";//6
respuestaPruebaHawk+="GRALES - COINCIDENCIA POR IDENTIFICACIONESHR081408200900030310116PRUEBA6 BC      ";
respuestaPruebaHawk+="0248EMPLEO 1 - COINCIDENCIA POR RAZON SOCIAL        HR080309200900038500116BURO DE ";
respuestaPruebaHawk+="CREDITO 0248TELEFONO 2224828999 NO CORRESPONDE A ZONA POSTALHR080309200900038600116BURO ";
respuestaPruebaHawk+="DE CREDITO 0245TELEFONO 2224828999 CORRESPONDE A NUMERO FIJOHR080309200900038900116BURO ";
respuestaPruebaHawk+="DE CREDITO 0243COLONIA NO COINCIDE CON CODIGO POSTAL 20467HR080309200900038600116BURO ";
respuestaPruebaHawk+="DE CREDITO 0245TELEFONO 5557129999 CORRESPONDE A NUMERO ";
respuestaPruebaHawk+="FIJOES050269200093293774490102**";

respuestaPruebaHawk = respuestaPruebaHawk.Replace("+","0");


			string OtraRespuesta="INTL11                         MX0000BC1234567810PN06PRUEBA0007EJEMPLO0109CONSULTAS0207NOMBRES0306NOMBRE0408";
OtraRespuesta+="010119630510BUYJ6301220602SR0802MX090111101S1201FPA23STA URSULA NO 520 CSA";
OtraRespuesta+="1 0207TLALPAN0312CD DE ";
OtraRespuesta+="MEXICO0402DF050514420070757370181001H1101K120827041997PA25NICOLAS SAN JUAN ";
OtraRespuesta+="NUM 87940109DEL ";
OtraRespuesta+="MORAL0306MEXICO0402DF05050310007076010041120814091995PE30SERVICIOS ";
OtraRespuesta+="ADMINISTRATIVOS SUMA0011NTE 75 25910122SN SALVADOR XOCHIMANCA0412CD DE ";
OtraRespuesta+="MEXICO0502DF06050287007101555341616170810112004PE30SERVICIOS ADMINISTRATIVOS ";
OtraRespuesta+="SUMA0011NTE 75 25910122SN SALVADOR XOCHIMANCA0412CD DE ";
OtraRespuesta+="MEXICO0502DF06050287007101555341616170810112004TL08170920020205BANCO0501I0601";
OtraRespuesta+="R0702CC0802N$1101Z120101308010919941408250720021608300820021708300820021801A1";
OtraRespuesta+="908300820022105124912305120002602UR2724111111111111111111X1111128083007200229";
OtraRespuesta+="08300820003002LS3103031TL08150220040205BANCO0501I0601R0702CC0802N$1101Z120327";
OtraRespuesta+="01308010719901408130219911508020819911608270120041708270120041801A21032702204";
OtraRespuesta+="270+23047000240311925029926029727249999999X9999999999999999280827122003290827";
OtraRespuesta+="0419983002UP31031623202993302993402993502993603119370827122000380297TL0820022";
OtraRespuesta+="0040214COMUNICACIONES0501I0601O0702CL0802N$1101M12033031308081220001408120120";
OtraRespuesta+="041708310120041801A19081106200321036472204303+2304100024033032602022718222221";
OtraRespuesta+="2222221212322808311220032908310720023603739370831082002380203TL08170220040205";
OtraRespuesta+="BANCO0501I0601R0702CC0802N$1101Z120421011308290919941408270120041508181220031";
OtraRespuesta+="708300120041801A210513440220610740+23051200026020127171X111X111111X1111280830";
OtraRespuesta+="1220032908300820023103032TL08140320030210AUTOMOTRIZ0501I0601I0702AU0802N$0906";
OtraRespuesta+="1380761002121101M120101308250620011408180720021608180720021708280220031801A21";
OtraRespuesta+="056000022020+240102602012720111111111111111111112808280120032908280620013002C";
OtraRespuesta+="ZTL08220820020214COMUNICACIONES0501I0601O0702CL0802N$1101M1308261219941408240";
OtraRespuesta+="419981608240419981708310720021801A1908240419982602013002CCTL08120820020110BC1";
OtraRespuesta+="23456780213NOMBRE ";
OtraRespuesta+="INSTIT041612345555550175970501I0601R0702CL0802N$1101Z120410391308011219871408";
OtraRespuesta+="110720021508100720021708120720021801A1908121020012104798822057988+23052800026";
OtraRespuesta+="02012724111111X1111111XXXXXXXX11280812062002290812061998370812061999380202TL0";
OtraRespuesta+="8190220040110BC123456780213NOMBRE ";
OtraRespuesta+="INSTIT041055023283450501I0601R0702CL0802N$1101Z120412711308011219871408100220";
OtraRespuesta+="041508120220041708120220041801A210512239220611924+230528000250112602012718112";
OtraRespuesta+="1111211111111112808120120042908120820023603992370812112003380202IQ08251020040";
OtraRespuesta+="205BANCO0402MI060100701IIQ08251020040205BANCO0402MI060100701IRS0815111995000";
OtraRespuesta+="20001020002020003020004020005020106020507020008020109040008100400011104000712";
OtraRespuesta+="04000413040002140400021502001602011701N1805NNNNN1901N2002N$210534314220569000";
OtraRespuesta+="230631225+2403422250447142602442701028020+29010300103102003202013302003408011";
OtraRespuesta+="21987350825062001360201370810112004380200390800000000400200410800000000ES0502";
OtraRespuesta+="79500090789356500102**";

OtraRespuesta= OtraRespuesta.Replace("+","0");

			#endregion


			//string error = "ERRRAR25NUMEROREFERENCIAOPERADOR 0014NO AUTENTICADOES05000660002**";
			RespuestaFormatoINTL qwe = new RespuestaFormatoINTL(conn);//12010
			//qwe.recibirRespuesta("INTL11                         MX0000BC1234567810"+asdasd3);
			//qwe.recibirRespuesta(respuestaPruebaHawk);
			//qwe.recibirRespuesta(error);
			qwe.recibirRespuesta(OtraRespuesta);
			qwe.RespuestaFinalAlRFC("0",idConsulta,partner);
			Console.ReadLine();
		}
	}
}
